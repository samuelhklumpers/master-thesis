\documentclass[../Main.tex]{subfiles}

\begin{document}
\begin{code}%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--cubical}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Tex.Flatten}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Prelude}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{‚åä\AgdaUnderscore{}‚åã}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{ProgOrn.Ornaments}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.List}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Vec}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Vec}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cubical.Data.Nat}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{N}\<%
\\
\>[0]\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Fin}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{Fin}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Bool}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Fin}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{to‚Ñï}\AgdaSymbol{)}\<%
\end{code}

%<*RField>
\AgdaTarget{RField}
\begin{code}%
\>[0]\AgdaFunction{RField}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{RDesc}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
\>[0]\AgdaFunction{RField}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{·πø}\AgdaSpace{}%
\AgdaBound{is}\AgdaSymbol{)}%
\>[15]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{‚ä§}\<%
\\
\>[0]\AgdaFunction{RField}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaBound{D}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{RField}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{D}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\<%
\end{code}
%</RField>

%<*Number>
\AgdaTarget{Number}
\AgdaTarget{ùüô}
\AgdaTarget{·πø}
\begin{code}%
\>[0]\AgdaComment{--\ note\ to\ self,\ I\ should\ probably\ make\ ·πø\ \AgdaUnderscore{}not\AgdaUnderscore{}\ overlap}\<%
\\
\>[0]\AgdaComment{--\ so\ not\ everything\ links\ here}\<%
\\
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Number}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Number}\<%
\\
%
\>[2]\AgdaInductiveConstructor{·πø}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Fin}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Number}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Number}\<%
\end{code}
%</Number>

%<*RSize>
\AgdaTarget{RSize}
\begin{code}%
\>[0]\AgdaFunction{RSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{d}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{RDesc}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{RField}\AgdaSpace{}%
\AgdaBound{d}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{‚Ñï}\<%
\\
\>[0]\AgdaFunction{RSize}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{·πø}\AgdaSpace{}%
\AgdaBound{is}\AgdaSymbol{)}%
\>[14]\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{is}\<%
\\
\>[0]\AgdaFunction{RSize}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaBound{D}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{RSize}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{fst}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{snd}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\end{code}
%</RSize>

%<*Fields>
\AgdaTarget{Fields}
\AgdaTarget{leaf}
\AgdaTarget{node}
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Fields}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{d}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{RDesc}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Number}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{leaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{RField}\AgdaSpace{}%
\AgdaBound{d}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Fields}\AgdaSpace{}%
\AgdaBound{d}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\<%
\\
%
\>[2]\AgdaInductiveConstructor{node}%
\>[110I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Fin}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Number}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[110I]%
\>[7]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Fin}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Fields}\AgdaSpace{}%
\AgdaBound{d}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Fields}\AgdaSpace{}%
\AgdaBound{d}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{·πø}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}
%</Fields>

%<*subnodes>
\AgdaTarget{subnodes}
\begin{code}%
\>[0]\AgdaFunction{subnodes}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{d}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{RDesc}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Fields}\AgdaSpace{}%
\AgdaBound{d}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Number}\<%
\\
\>[0]\AgdaFunction{subnodes}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{leaf}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}%
\>[20]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{·πø}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{RSize}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\<%
\\
\>[0]\AgdaFunction{subnodes}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{·πø}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{subnodes}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\end{code}
%</subnodes>

%<*nested>
\AgdaTarget{nested}
\begin{code}%
\>[0]\AgdaFunction{nested}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Desc}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Desc}\AgdaSpace{}%
\AgdaDatatype{Number}\<%
\\
\>[0]\AgdaFunction{nested}\AgdaSpace{}%
\AgdaBound{d}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Fields}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{d}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{·πø}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaFunction{subnodes}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\end{code}
%</nested>


\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Dummy}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{field}\<%
\end{code}
%<*wish>
\begin{code}%
\>[4][@{}l@{\AgdaIndent{1}}]%
\>[8]\AgdaField{nested-eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âÉ}}\AgdaSpace{}%
\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{nested}\AgdaSpace{}%
\AgdaBound{D}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\<%
\end{code}
%</wish>

tmp : {E : Desc ‚ä§} ‚Üí (d : RDesc ‚ä§) ‚Üí ‚ü¶ d ‚üß (Œº E) ‚Üí RField d
tmp (·πø is)  x = tt
tmp (œÉ S D) x = fst x , tmp (D (fst x)) (snd x)

module _ (D : Desc ‚ä§) where
  left = Œº D tt
  D' = nested D
  right = Œº D'

  to : left ‚Üí right ùüô
  to (con x) = con (leaf (tmp (D tt) x) , {!!} , _)
