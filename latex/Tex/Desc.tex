\begin{code}[hide] %
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Tex.Desc}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Agda.Primitive}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Level}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{zero}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaPrimitive{‚Ñì-zero}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaPrimitive{suc}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaPrimitive{‚Ñì-suc}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{\AgdaUnderscore{}‚äî\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚Ñì-max}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Unit}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Empty}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Sum}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{map‚ÇÇ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Function.Base}\<%
\end{code}

To be able to reason about datatypes themselves, we first have to represent datatypes by another datatype.
%To inspect a datatype and manipulate its values safely, we have to represent the datatype internally.
This can be done by defining a datatype of codes instructing how datatypes can be formed, together with a function assigning the meaning to this encoding, henceforth description and interpretation respectively. We will start from an encoding which captures only a small set of types, and work towards an encoding of parametrized indexed types.
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Finite}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}

We can describe the universe of finite types with the following description:
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{ùüò}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}%
\>[13]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚äï\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚äó\AgdaUnderscore{}}}%
\>[13]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\end{code}
Each of the constructors of this description represents a type-former. In this case, the universe only contains sums and products of the 0 and 1; the meaning of the type-formers comes from the interpretation:
\begin{code}%
%
\>[2]\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
%
\>[2]\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüò}%
\>[13]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚ä•}\<%
\\
%
\>[2]\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}%
\>[13]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{‚ä§}\<%
\\
%
\>[2]\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSymbol{)}%
\>[13]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚äé}}\AgdaSpace{}%
\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaBound{E}\<%
\\
%
\>[2]\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äó}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSymbol{)}%
\>[13]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaFunction{Œº}\AgdaSpace{}%
\AgdaBound{E}\<%
\end{code}
Booleans live in this universe as
\begin{code}%
%
\>[2]\AgdaFunction{BoolD}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[2]\AgdaFunction{BoolD}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\<%
\end{code}
but to encode a type like \bN{} we need a different setup. Consider the definition
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{‚Ñï}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{zero}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{‚Ñï}\<%
\\
%
\>[2]\AgdaInductiveConstructor{suc}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{‚Ñï}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{‚Ñï}\<%
\end{code}
we can interpret this as the declaration \texttt{‚Ñï ‚âÉ ‚ä§ ‚äé ‚Ñï}, and formally \AgdaDatatype{‚Ñï} is indeed the least fixpoint of this equation. In category theoretic terms we would say that \AgdaDatatype{‚Ñï} is the initial algebra of its base functor \texttt{(‚ä§ ‚äé\_)}.
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Recursive}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\end{code} 
Letting
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\end{code}
assign base functors to descriptions, we can take the fixpoint as
\begin{code}%
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaBound{D}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaBound{D}\<%
\end{code}
We see that if \texttt{‚ü¶ ND ‚üß} is \texttt{(‚ä§ ‚äé\_)}, then \texttt{Œº ND} satisfies the equation for \AgdaDatatype{‚Ñï}.

We change the codes to
\begin{code}%
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaInductiveConstructor{œÅ}%
\>[13]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚äï\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚äó\AgdaUnderscore{}}}%
\>[13]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\end{code}
and describe the base functors:
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{‚ä§}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{œÅ}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaBound{E}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚äé}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äó}}\AgdaSpace{}%
\AgdaBound{E}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\<%
\end{code}
Now, \AgdaInductiveConstructor{ùüô} encodes the leaves of a datatype, and \AgdaInductiveConstructor{œÅ} encodes a recursive node. The operators \AgdaInductiveConstructor{‚äï} and \AgdaInductiveConstructor{‚äó} are changed to act pointwise. %(Conspicuously, 0 is missing, but you can see that \AgdaDatatype{‚ä•} is still represented in the universe. After all, \texttt{Œº œÅ} has no values).
In this universe, we can define \AgdaDatatype{‚Ñï} by
\begin{code}%
%
\>[2]\AgdaFunction{‚ÑïD}%
\>[6]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[2]\AgdaFunction{‚ÑïD}%
\>[6]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaInductiveConstructor{œÅ}\<%
\end{code}
To describe complex types more practically, we can merge \AgdaInductiveConstructor{œÅ} and \AgdaInductiveConstructor{‚äó}, and add a variant \AgdaInductiveConstructor{œÉ} of \AgdaInductiveConstructor{‚äó}, which then represent adding a recursive and a non-recursive field respectively
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{NearSOP}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{ùüô}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[4]\AgdaInductiveConstructor{œÅ}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[4]\AgdaInductiveConstructor{œÉ}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚äï\AgdaUnderscore{}}}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\end{code}
In \AgdaInductiveConstructor{œÉ}, we ask for a function \texttt{S ‚Üí Desc} rather than just a \AgdaDatatype{Desc}, modelling a \AgdaDatatype{Desc} with a bound variable of type \texttt{S}. The interpretation is similar, interpreting \AgdaInductiveConstructor{œÅ} and \AgdaInductiveConstructor{œÉ} as a product and dependent product respectively.
%\texttt{œÅ D} as \texttt{X √ó ‚ü¶ D ‚üß X} and \texttt{œÉ S D} as \texttt{Œ£[ s ‚àà S ] ‚ü¶ D s ‚üß X}.

In this universe we can describe types in which the fields be either \texttt{X}, the type itself, or another type \texttt{S}. For example, we can describe \AgdaDatatype{List} as
\begin{code}%
%
\>[2]\AgdaFunction{ListD}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\<%
\\
%
\>[2]\AgdaFunction{ListD}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{œÅ}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSymbol{)}\<%
\end{code}
using a type parameter from outside the description. We will soon see how we can internalize parameters, but since internalizing indices is easier, we will tackle indices first.

We should note that there are two strategies we can use to describe an indexed type. First, we can define a description of a type indexed by \texttt{I} to simply be a function \texttt{I ‚Üí Desc}, yielding a universe of index-first types. Second, we can pull the index completely into \AgdaDatatype{Desc}, and let \AgdaInductiveConstructor{ùüô} declare the index at the leaf of a constructor, more closely resembling Agda's datatypes. Both have their advantages and disadvantages, mainly, index-first datatypes are more space efficient. We opt however for the second option, because as we will see later, this allows us to keep descriptions ``relatively small'' (i.e., something like foldable) and more flexible in their levels.
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Indexed}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaKeyword{variable}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\end{code}
\begin{code}%
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{ùüô}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\<%
\\
%
\>[4]\AgdaInductiveConstructor{œÅ}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\<%
\\
%
\>[4]\AgdaInductiveConstructor{œÉ}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\<%
\\
%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚äï\AgdaUnderscore{}}}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{I}\<%
\end{code}
Now \texttt{ùüô j} says that this branch constructs a term of \texttt{X j}, while \texttt{œÅ i} asks for a recursive field \texttt{X i}. As \texttt{Desc I} describes a type indexed by \texttt{I}, which is a function \texttt{I ‚Üí Type}, we also have to interpret \texttt{Desc I} as an indexed functor 
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaBound{j}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaBound{j}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{œÅ}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{D}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaBound{D}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaBound{E}%
\>[11]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚äé}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{i}\<%
\end{code}
Applying an interpretation to an index asks for the constructors at that index. We see that by interpreting \texttt{ùüô j} as an equality, we ensure that asking for an index indeed gives that index.

In this universe we can describe vectors
\begin{code}%
%
\>[2]\AgdaFunction{VecD}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaDatatype{‚Ñï}\<%
\\
%
\>[2]\AgdaFunction{VecD}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚äï}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaDatatype{‚Ñï}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{œÅ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)))}\<%
\end{code}
making use of the variable binding in \AgdaInductiveConstructor{œÉ} to state that if we get a vector of length \texttt{n}, then we can construct a vector of length \texttt{suc n}.

The observant reader might have noticed that we claim \texttt{I ‚Üí Desc} does not give small descriptions, but still allow for \texttt{S ‚Üí Desc}. We can fix this issue at the same time we implement parameters, keeping a form of variable binding. Implementing types with a single parameter can be done by interpreting to ``endofunctors'' \texttt{Type ‚Üí I ‚Üí Type}, adding another type-former accessing the parameter. To handle types with more parameters, which may depend on each other, we abstract descriptions over lists of parameters.

We will first need some structure expressing the kinds of parameters that we can have. We could try using List Type, but this rules out types like \texttt{Œ£ (A : Type) (B : A ‚Üí Type)}. Instead, we use a telescope, a list of types which explicitly captures the dependencies. We define telescopes and their meaning by induction-recursion:
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Tele}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
\>[0]\<%
\\
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{‚àÖ}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\<%
\\
%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚ñ∑\AgdaUnderscore{}}}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Tel}\<%
\end{code}
A telescope can either be empty, or be formed from a telescope and a type in the context of that telescope.

Contexts are interpreted as
\begin{code}[hide]%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚àÖ}%
\>[11]\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{‚ä§}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ñ∑}}\AgdaSpace{}%
\AgdaBound{S}%
\>[11]\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaBound{S}\<%
\end{code}
To deal with variables, we will also need to be able to describe variable telescopes. This means that while the parameter telescope in a description stays constant, the variable telescope grows independently when we add more \AgdaInductiveConstructor{œÉ}'s. We can represent this by parametrizing telescopes over a type
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Parameter}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaKeyword{variable}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaGeneralizable{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\<%
\\
%
\>[4]\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\end{code}
\begin{code}%
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ä¢\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{a}\<%
\\
%
\>[2]\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\<%
\\
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{‚àÖ}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaBound{P}\<%
\\
%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚ñ∑\AgdaUnderscore{}}}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaBound{P}\<%
\end{code}
We define a shorthand \texttt{Œì ‚ä¢ A} for the type of \texttt{S}, representing a value of \texttt{A} in context \texttt{Œì}. By changing \texttt{‚ü¶\_‚üßtel} to depend on a value of \texttt{P} as
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚àÖ}%
\>[11]\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{‚ä§}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ñ∑}}\AgdaSpace{}%
\AgdaBound{S}%
\>[11]\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}
a telescope of the form
\begin{code}%
%
\>[2]\AgdaFunction{ExTel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\<%
\\
%
\>[2]\AgdaFunction{ExTel}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSymbol{)}\<%
\end{code}
\begin{code}[hide]%
%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaKeyword{variable}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaGeneralizable{Œî}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaGeneralizable{P}\<%
\\
%
\>[4]\AgdaGeneralizable{V}\AgdaSpace{}%
\AgdaGeneralizable{W}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ExTel}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\<%
\\
%
\>[4]\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\end{code}
can access all values of \texttt{Œì}, and can be treated as an extension of \texttt{Œì}. To interpret them, we define
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}\&\AgdaUnderscore{}‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{V}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ExTel}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\&}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\<%
\end{code}
To make use of this we also split \AgdaInductiveConstructor{‚äï} and \AgdaDatatype{Desc}, making \AgdaDatatype{Desc} a list of constructors, in line with actual Agda datatypes
\begin{code}%
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{V}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ExTel}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\<%
\\
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Tel}\AgdaSpace{}%
\AgdaRecord{‚ä§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type‚ÇÅ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{[]}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{I}\<%
\\
%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}‚à∑\AgdaUnderscore{}}}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaInductiveConstructor{‚àÖ}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{I}\<%
\end{code}
A constructor then starts off with the empty variable context, which grows as fields are added
\begin{code}%
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{ùüô}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{I}\<%
\\
%
\>[4]\AgdaInductiveConstructor{œÅ}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{I}\<%
\\
%
\>[4]\AgdaInductiveConstructor{œÉ}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä¢}}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚ñ∑}}\AgdaSpace{}%
\AgdaBound{S}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{I}\<%
\end{code}
replacing \texttt{I} by \texttt{V ‚ä¢ I} in \AgdaInductiveConstructor{ùüô} and \AgdaInductiveConstructor{œÅ} allows the index of a constructor or argument to depend on the preceding fields, of which the values are made accessible by appending them to the context as \texttt{V ‚ñ∑ S} in \AgdaInductiveConstructor{œÉ}. Finally, we interpret this as
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üßC}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Con}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaGeneralizable{V}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\&}}\AgdaSpace{}%
\AgdaGeneralizable{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\&}}\AgdaSpace{}%
\AgdaGeneralizable{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùüô}\AgdaSpace{}%
\AgdaBound{j}%
\>[11]\AgdaOperator{\AgdaFunction{‚üßC}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{œÅ}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{C}%
\>[11]\AgdaOperator{\AgdaFunction{‚üßC}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßC}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{œÉ}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaBound{C}%
\>[11]\AgdaOperator{\AgdaFunction{‚üßC}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSymbol{@(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{S}\AgdaSpace{}%
\AgdaBound{pv}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßC}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaFunction{map‚ÇÇ}\AgdaSpace{}%
\AgdaField{proj‚ÇÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üßD}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[12]\AgdaOperator{\AgdaFunction{‚üßD}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚ä•}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{‚à∑}}\AgdaSpace{}%
\AgdaBound{Cs}%
\>[12]\AgdaOperator{\AgdaFunction{‚üßD}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßC}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaField{proj‚ÇÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}%
\>[54]\AgdaOperator{\AgdaDatatype{‚äé}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{Cs}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßD}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{i}\<%
\end{code}
with the fixpoint
\begin{code}%
%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Desc}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßtel}}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßD}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaBound{D}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Œº}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{i}\<%
\end{code}
